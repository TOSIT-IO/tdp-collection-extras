# Copyright 2022 TOSIT.IO
# SPDX-License-Identifier: Apache-2.0

---
auth_to_local:
  jupyterhub:
    - RULE:[2:$1/$2@$0](jupyterhub/.*@{{ realm }})s/.*/jupyterhub/
  hue:
    - RULE:[2:$1/$2@$0](hue/.*@{{ realm }})s/.*/hue/
  livy:
    - RULE:[2:$1/$2@$0](livy/.*@{{ realm }})s/.*/livy/

core_site:
  hadoop.proxyuser.jupyterhub.groups: '*'
  hadoop.proxyuser.jupyterhub.hosts: >-
    {%- if hadoop_proxyuser_hosts_groups.jupyterhub is defined and hadoop_proxyuser_hosts_groups.jupyterhub | length > 0 -%}
    {{
      hadoop_proxyuser_hosts_groups.jupyterhub
      | map('extract', groups)
      | map('default', False)
      | flatten
      | select()
      | map('tosit.tdp.access_fqdn', hostvars)
      | unique
      | join(',')
    }}
    {%- else -%}
        ""
    {%- endif -%}
  hadoop.proxyuser.hue.hosts: >-
    {%- if hadoop_proxyuser_hosts_groups.hue is defined and hadoop_proxyuser_hosts_groups.hue | length > 0 -%}
    {{
      hadoop_proxyuser_hosts_groups.hue
      | map('extract', groups)
      | map('default', False)
      | flatten
      | select()
      | map('tosit.tdp.access_fqdn', hostvars)
      | unique
      | join(',')
    }}
    {%- else -%}
        ""
    {%- endif -%}
  hadoop.proxyuser.hue.groups: '*'
  hadoop.proxyuser.livy.hosts: >-
    {%- if hadoop_proxyuser_hosts_groups.livy is defined and hadoop_proxyuser_hosts_groups.livy | length > 0 -%}
    {{
      hadoop_proxyuser_hosts_groups.livy
      | map('extract', groups)
      | map('default', False)
      | flatten
      | select()
      | map('tosit.tdp.access_fqdn', hostvars)
      | unique
      | join(',')
    }}
    {%- else -%}
        ""
    {%- endif -%}
  hadoop.proxyuser.livy.groups: "*"
